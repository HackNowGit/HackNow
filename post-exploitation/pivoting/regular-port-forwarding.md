# Regular Port Forwarding

## Ipconfig

* looking for machines that have at least THREE network interfaces (loopback, eth0, and eth1)
* these machines are connected to other networks, so use them to pivot

### Windows

```bash
ipconfig /all
route print
arp -a
```

### Linux

```bash
ifconfig
ifconfig -a
arp -a
```

## Port Forwarding and Tunneling

* imagine that a has a ftp server (or any other port) to upload or download some files
* someone has put some crazy firewall rules (egress filters) that prohibits outgoing traffics on all ports except for port 80
* how are we going to be able to connect to our ftp-server?
* add a machine that redirect/forward all traffic that it receives on port 80 to port 21 on a different machine
* instead of having this kind of traffic

```bash
home-computer/port-21 ----> ftp-server/port-21
```

* we will have

```bash
home-computer/port-80 ----> port-80/proxy-machine/port-21 ----> ftp-server
```

* and the other way around to receive the traffic.
* how is this implemented?

### Rinetd - Port forward/redirect

* set up this port forwarding machine with the help of Rinetd
* Machine1 - IP: 111.111.111.111 - behind firewall, and wants to connect to Machine3
* Machine2 - IP: 222.222.222.222 - forwards incoming connections to Machine3
* Machine3 - IP: 333.333.333.333 - hosts the ftp-server that machine1 wants to connect to.

```bash
apt-get install rinetd
```

```bash
default config file /etc/rinetd.conf
```

* this is the essential part of the configuration file, this is where we create the port-forwarding

```bash
# bindadress     bindport    connectaddress  connectport
0.0.0.0    80     333.333.333.333       21

# restart rinetd
/etc/init.d/rinetd restart

# use ss to verify it is working
ss -antp | grep "<port #>"
```

* the bind-address is where the proxy receives the connection
* the connect address is the machine it forwards the connection to

## References

* This is a good video-explanation
* [https://www.youtube.com/watch?v=c0XiaNAkjJA](https://www.youtube.com/watch?v=c0XiaNAkjJA)
* [https://www.offensive-security.com/metasploit-unleashed/pivoting/](https://www.offensive-security.com/metasploit-unleashed/pivoting/)
* [http://ways2hack.com/how-to-do-pivoting-attack/](http://ways2hack.com/how-to-do-pivoting-attack/)
